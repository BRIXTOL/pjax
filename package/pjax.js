(function(v,S){typeof exports=="object"&&typeof module<"u"?S(exports):typeof define=="function"&&define.amd?define(["exports"],S):(v=typeof globalThis<"u"?globalThis:v||self,S(v.Pjax={}))})(this,function(v){"use strict";function S(){return S=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},S.apply(this,arguments)}var R;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(R||(R={}));var Ot=function(t){return t},Ct="beforeunload",ve="popstate";function ge(t){t===void 0&&(t={});var e=t,n=e.window,r=n===void 0?document.defaultView:n,o=r.history;function s(){var h=r.location,y=h.pathname,T=h.search,I=h.hash,L=o.state||{};return[L.idx,Ot({pathname:y,search:T,hash:I,state:L.usr||null,key:L.key||"default"})]}var c=null;function l(){if(c)B.call(c),c=null;else{var h=R.Pop,y=s(),T=y[0],I=y[1];if(B.length){if(T!=null){var L=F-T;L&&(c={action:h,location:I,retry:function(){J(L*-1)}},J(L))}}else It(h)}}r.addEventListener(ve,l);var i=R.Pop,u=s(),F=u[0],at=u[1],ue=Rt(),B=Rt();F==null&&(F=0,o.replaceState(S({},o.state,{idx:F}),""));function he(h){return typeof h=="string"?h:Ee(h)}function de(h,y){return y===void 0&&(y=null),Ot(S({pathname:at.pathname,hash:"",search:""},typeof h=="string"?lt(h):h,{state:y,key:xe()}))}function fe(h,y){return[{usr:h.state,key:h.key,idx:y},he(h)]}function pe(h,y,T){return!B.length||(B.call({action:h,location:y,retry:T}),!1)}function It(h){i=h;var y=s();F=y[0],at=y[1],ue.call({action:i,location:at})}function ye(h,y){var T=R.Push,I=de(h,y);function L(){ye(h,y)}if(pe(T,I,L)){var Q=fe(I,F+1),St=Q[0],ct=Q[1];try{o.pushState(St,"",ct)}catch{r.location.assign(ct)}It(T)}}function me(h,y){var T=R.Replace,I=de(h,y);function L(){me(h,y)}if(pe(T,I,L)){var Q=fe(I,F),St=Q[0],ct=Q[1];o.replaceState(St,"",ct),It(T)}}function J(h){o.go(h)}var Gn={get action(){return i},get location(){return at},createHref:he,push:ye,replace:me,go:J,back:function(){J(-1)},forward:function(){J(1)},listen:function(h){return ue.push(h)},block:function(h){var y=B.push(h);return B.length===1&&r.addEventListener(Ct,Nt),function(){y(),B.length||r.removeEventListener(Ct,Nt)}}};return Gn}function Nt(t){t.preventDefault(),t.returnValue=""}function Rt(){var t=[];return{get length(){return t.length},push:function(e){return t.push(e),function(){t=t.filter(function(n){return n!==e})}},call:function(e){t.forEach(function(n){return n&&n(e)})}}}function xe(){return Math.random().toString(36).substr(2,8)}function Ee(t){var e=t.pathname,n=e===void 0?"/":e,r=t.search,o=r===void 0?"":r,s=t.hash,c=s===void 0?"":s;return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),c&&c!=="#"&&(n+=c.charAt(0)==="#"?c:"#"+c),n}function lt(t){var e={};if(t){var n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));var r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}const E=ge(),A=Object.assign,be=Object.keys,g=Object.create,Mt=Array.isArray,W=Array.from,ut="",a={targets:["body"],timeout:3e4,poll:15,schema:"pjax",async:!0,cache:!0,reverse:!0,limit:50,preload:null,hover:{trigger:"attribute",threshold:250},intersect:{rootMargin:"0px 0px 0px 0px",threshold:0},proximity:{distance:75,threshold:250,throttle:500},progress:{color:"#111",height:"3px",minimum:.08,easing:"cubic-bezier(0,1,0,1)",speed:300,trickle:!0,threshold:350,trickleSpeed:300}},d=new Set,p=g(null),M=g(null),m=g(null),$=g(null),O=g(null),x=g(null),ht=new Set,C=g(null),$e={__proto__:null,config:a,connect:d,schema:p,position:M,pages:m,snaps:$,events:O,transit:x,tracked:ht,timers:C},we=/https?:\/\/(w{3}\.)?/,ke=/(?:https?:)?\/\/(?:w{3}\.)?([^/]*?)?([/?][^;]*?)?(#[^#]*?)?$/i,Pe=/\b(?:append|prepend)/,Te=/^(?:application|text)\/(?:x-)?(?:ecma|java)script|text\/javascript$/,Le=/^\b(?:true|false)$/i,dt=/^[+-]?\d*\.?\d+$/,Ae=/\s+/g,Ht=/\[?[^,'"[\]()\s]+\]?/g,je=/\(?\[(['"]?.*['"]?,?)\]\)?/,Ie=/[xy]:[0-9.]+/,Se=/[xy]|\d*\.?\d+/g;var Oe=Math.pow;function Z(...t){return t.join(ut)}function Ce(t=2){return(e,n)=>{const r=e.length;return(r<1||e[r-1].length===t?e.push([n]):e[r-1].push(n))&&e}}function Ne(t){const e=g(null);return H((n,r,o)=>{const s=o.length-1>=r?r-1:r;r%2&&(e[o[s]]=dt.test(n)?Number(n):n)},t),e}function ft(t,e){if(t instanceof Element){const n=t.closest(e);if(n&&n.tagName==="A")return n}return!1}function Re(t){return new Blob([t]).size}function pt(t){if(t.nodeName!=="A")return!1;const e=t.getAttribute("href");return!(e in m&&"snapshot"in m[e]?m[e].snapshot in $:!1)}function Me(t,e){const n=document.body.querySelectorAll(t);return W(n).flatMap(r=>r.nodeName!=="A"?W(r.querySelectorAll(e)).filter(pt):pt(r)?r:[])}function yt(t){const e=document.body.querySelectorAll(t);return W(e).filter(pt)}function He(t){if(t===0)return"0 B";const e=parseInt(`${Math.floor(Math.log(t)/Math.log(1024))}`,10),n=["B","KB","MB","GB","TB"];return e===0?`${t} ${n[e]}`:`${(t/Oe(1024,e)).toFixed(1)} ${n[e]}`}function H(t,e){if(arguments.length===1)return o=>H(t,o);const n=e.length;if(n===0)return;let r=0;for(;r<n;)t(e[r],r,e),r++}function mt(t){const e=Object.getOwnPropertyNames(t);return e.length===0?!0:e.every(n=>delete t[n])}function qe(t){const e="hydrate|append|prepend|replace|progress|threshold|position|proximity|hover|history";return p.attrs=new RegExp(`^href|${t.schema}-(${e})$`,"i"),p.hydrate=`[${t.schema}-hydrate]`,p.href=`a:not([${t.schema}-disable]):not([href^="#"])`,p.track=`[${t.schema}-track]:not([${t.schema}-track=false])`,p.scripts=`script:not([${t.schema}-eval=false])`,p.styles=`style:not([${t.schema}-eval=false])`,p.stylelink=`link[rel=stylesheet]:not([${t.schema}-eval=false])`,typeof t.intersect=="object"&&(p.intersect=`[${t.schema}-intersect]:not([${t.schema}-intersect=false])`,p.interhref=Z("a",`:not([${t.schema}-disable])`,`:not(a[${t.schema}-intersect=false])`,':not([href^="#"])')),typeof t.proximity=="object"&&(p.proximity=Z("a",`[${t.schema}-proximity]`,`:not([${t.schema}-proximity=false])`,`:not([${t.schema}-disable])`,':not([href^="#"])')),typeof t.hover=="object"&&(p.mouseover=t.hover.trigger==="href"?Z("a",`:not([${t.schema}-disable])`,`:not([${t.schema}-hover=false])`,`:not([${t.schema}-intersect])`,`:not([${t.schema}-proximity])`,':not([href^="#"])'):Z("a",`[${t.schema}-hover]`,`:not([${t.schema}-intersect])`,`:not([${t.schema}-proximity])`,`:not([${t.schema}-disable])`,`:not([${t.schema}-hover=false])`,':not([href^="#"])')),t}function De(t={}){t.hover!==!1&&(A(a.hover,t.hover),delete t.hover),t.intersect!==!1&&(A(a.intersect,t.intersect),delete t.intersect),t.proximity!==!1&&(A(a.proximity,t.proximity),delete t.proximity),t.progress!==!1&&(A(a.progress,t.progress),delete t.progress);const e=A(a,t);return e.schema=e.schema===null?"data":`data-${e.schema}`,qe(e),e}var f=(t=>(t[t.INITIAL=1]="INITIAL",t[t.VISIT=2]="VISIT",t[t.HYDRATE=3]="HYDRATE",t[t.HOVER=4]="HOVER",t[t.INTERSECT=5]="INTERSECT",t[t.PROXIMITY=6]="PROXIMITY",t[t.PRELOAD=7]="PRELOAD",t[t.REVERSE=8]="REVERSE",t[t.POPSTATE=9]="POPSTATE",t[t.RELOAD=10]="RELOAD",t[t.PREFETCH=11]="PREFETCH",t[t.CAPTURE=12]="CAPTURE",t[t.FETCH=13]="FETCH",t))(f||{});const{origin:vt}=window.location,qt=vt.replace(we,ut);function Ve(t){const e=g(null);for(const{nodeName:n,nodeValue:r}of t.attributes){if(!p.attrs.test(n))continue;if(n==="href"){const c=lt(r);e.key=c.pathname+(c.search||""),e.location=Vt(e.key);continue}const o=n.slice(1+n.lastIndexOf("-")),s=r.replace(Ae,ut);je.test(s)?e[o]=Pe.test(o)?s.match(Ht).reduce(Ce(2),[]):s.match(Ht):Ie.test(s)?e[o]=Ne(s.match(Se)):Le.test(s)?e[o]=s==="true":dt.test(s)?e[o]=Number(s):e[o]=s}return e}function Dt(t){if(t.charCodeAt(0)===47&&t.charCodeAt(1)!==47){const n=t.indexOf("#");return n!==-1?t.slice(0,n):t}if(t.charCodeAt(0)===63)return location.pathname+t;const e=t.match(ke);return e!==null?qt!==e[1]?null:e[2]===void 0?"/":e[2]:null}function Vt(t){const e=g(null),{hash:n,pathname:r,search:o}=lt(t);return e.origin=vt,e.hostname=qt,e.pathname=r,e.lastpath=location.pathname+(location.search||""),o&&(e.search=o),n&&(e.hash=n),e}function b(t,e){if(t instanceof Element){const r=Ve(t);return r.type=e||f.VISIT,r}const n=g(null);return n.key=typeof t=="string"?Dt(t):location.pathname+location.search,n.location=Vt(n.key),n.type=e||f.VISIT,n}const Fe=new DOMParser;function gt(t){return Fe.parseFromString(t,"text/html")}var Be=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let r=n[t]&63;r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r<63?e+="_":e+="-"}return e};function j(t,...e){const n=t==="cache";n&&e.splice(-1,1,gt(e[e.length-1]));let r=!0;return H(o=>{const s=o.apply(null,e);n?s instanceof Document?r=s.documentElement.outerHTML:typeof r!="string"&&(r=s!==!1):r=s!==!1},O[t]||[]),r}function Xe(t,e){t in O||(O[t]=[]),O[t].push(e)}function Ye(t,e){const n=O[t],r=[];if(n&&e){let o=0;const s=n.length;for(;o<s;o++)n[o]!==e&&r.push(n[o])}return r.length?O[t]=r:delete O[t],this}let xt=!1;function tt(){return M}function Et(){M.y=window.scrollY,M.x=window.scrollX,xt||(requestAnimationFrame(tt),xt=!0)}function _e(){return xt=!1,M.x=0,M.y=0,M}function ze(){const t=g(null);return t.x=0,t.y=0,t}function Ue(){d.has(6)||(Et(),addEventListener("scroll",Et,{passive:!0}),d.add(6))}function We(){!d.has(6)||(removeEventListener("scroll",Et,!1),_e(),d.delete(6))}function et(t){typeof t>"u"?(mt(m),mt($)):typeof t=="string"?(delete $[m[t].snapshot],delete m[t]):Mt(t)&&Bt(t)}function w(t){const e=g(null);return e.key=null,e.history=!0,e.type=f.VISIT,e.title=document.title,e.replace=a.targets,e.cache=a.cache,e.snapshot=e.cache?Be():null,e.position=ze(),e.location=g(null),a.proximity!==!1&&(e.proximity=a.proximity.threshold),a.hover!==!1&&(e.threshold=a.hover.threshold),a.progress!==!1&&(e.progress=a.progress.threshold),e.cache||delete t.cache,A(e,t)}function bt(t){const e=m[bt.prototype.key];if(t==="page")return e;if(t==="location")return e.location;if(t==="snapshot")return $[e.snapshot]}function Ft(t,e){const n=j("cache",t,e);if(n!==!1){switch(t.type){case f.HOVER:case f.PROXIMITY:case f.INTERSECT:t.type=f.PREFETCH;break}return m[t.key]=t,bt.prototype.key=t.key,t.cache&&($[t.snapshot]=typeof n=="string"?n:e),t}}function nt(t,e){const n=t.key in m?A(m[t.key],t):w(t);return typeof e=="string"&&($[n.snapshot]=e),n}function Ke(t){const e=m[t],n=$[e.snapshot];return{page:e,snapshot:n}}function N(t){return t in m&&"snapshot"in m[t]?m[t].snapshot in $:!1}function Bt(t=[]){return Object.getOwnPropertyNames(m).forEach(e=>{t.includes(e)?delete $[m[e].snapshot]:delete m[e]})}var k=typeof window<"u"?window:{screen:{},navigator:{}},X=(k.matchMedia||function(){return{matches:!1}}).bind(k),Ge={get passive(){return!0}},Xt=function(){};k.addEventListener&&k.addEventListener("p",Xt,Ge),k.removeEventListener&&k.removeEventListener("p",Xt,!1);var q="PointerEvent"in k,$t="ontouchstart"in k,Je="TouchEvent"in k;$t||Je&&X("(any-pointer: coarse)").matches;var Yt=k.navigator.userAgent||"",Qe=X("(pointer: coarse)").matches&&/iPad|Macintosh/.test(Yt)&&Math.min(k.screen.width||0,k.screen.height||0)>=768;(X("(pointer: coarse)").matches||!X("(pointer: fine)").matches&&$t)&&/Windows.*Firefox/.test(Yt),X("(any-pointer: fine)").matches||X("(any-hover: hover)").matches;let D=null,K=null;const wt=[];function kt(t){const{speed:e,easing:n,minimum:r}=a.progress,o=typeof D=="number";t=zt(t,r,1),D=t===1?null:t;const s=Ze(!o);en(c=>{if(s.style.transform=`translate3d(${Ut(t)}%,0,0)`,s.style.transition=`all ${e}ms ${n}`,t!==1)return setTimeout(c,e);s.style.transition="none",s.style.opacity="1",setTimeout(()=>{s.style.transition=`all ${e}ms ${n}`,s.style.opacity="0",setTimeout(()=>[tn(),c()],e)},e)})}function _t(t){let e=D;if(!e)return Wt();if(e<1)return typeof t!="number"&&(e>=0&&e<.2?t=.1:e>=.2&&e<.5?t=.04:e>=.5&&e<.8?t=.02:e>=.8&&e<.99?t=.005:t=0),e=zt(e+t,0,.994),kt(e)}function Ze(t){if(K)return K;document.documentElement.classList.add("pjax-loading");const e=t?"-100":Ut(D||0),n=document.createElement("div");return n.id="pjax-progress",n.style.pointerEvents="none",n.style.background=a.progress.color,n.style.height=a.progress.height,n.style.position="fixed",n.style.zIndex="9999",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.transition="all 0 linear",n.style.transform=`translate3d(${e}%,0,0)`,document.body.appendChild(n),K=n,n}function tn(){document.documentElement.classList.remove("pjax-loading"),document.getElementById("pjax-progress")&&document.body.removeChild(K),K=null}function zt(t,e,n){return t<e?e:t>n?n:t}function Ut(t){return(-1+t)*100}function en(t){const e=()=>{const n=wt.shift();n&&n(e)};wt.push(t),wt.length===1&&e()}function Wt(){D||kt(0);const t=function(){setTimeout(()=>{!D||(_t(),t())},a.progress.trickleSpeed)};a.progress.trickle&&t()}function nn(t){if(!(!t&&!D))return _t(.3+.5*Math.random()),kt(1)}var Pt=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});let rt=0;function rn(t){return new Promise(e=>setTimeout(()=>e(t()),5))}function on(t,e){return Pt(this,null,function*(){rt=rt+Re(e)})}function Tt(t){const e=new XMLHttpRequest;return new Promise((n,r)=>{e.open("GET",t,a.async),e.setRequestHeader("X-Brixtol-Pjax","true"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.onloadstart=o=>{x[t]=e},e.onload=o=>{n(e.status===200?e.responseText:!1)},e.onabort=o=>{delete x[t]},e.onloadend=o=>{delete x[t],on(t,e.responseText)},e.onerror=r,e.timeout=a.timeout,e.responseType="text",e.send(null)})}function Kt(t,e,n){t in C||N(t)||(C[t]=setTimeout(e,n))}function sn(t){return t in C?(clearTimeout(C[t]),delete C[t]):!0}function an(){const t=g(null);return t.total=rt,t.weight=He(rt),t}function Gt(t){t in x&&(x[t].abort(),console.warn(`@brixtol/pjax: XHR Request was cancelled for url: ${t}`))}function cn(t){for(const e in x)t!==e&&(x[e].abort(),console.warn(`@brixtol/pjax: Cancelled pending request: ${e}`))}function Jt(t,e=0){return Pt(this,null,function*(){return t in x&&e<=a.timeout?(e*5===a.progress.threshold&&Wt(),e++,rn(()=>Jt(t,e))):delete x[t]})}function P(t){return Pt(this,null,function*(){if(t.key in x){console.warn(`@brixtol/pjax: XHR Request is already in transit for: ${t.key}`);return}if(!j("request",t))return console.info(`@brixtol/pjax: Request cancelled via dispatched event for: ${t.key}`),!1;try{const e=yield Tt(t.key);if(e)return Ft(t,e);console.warn(`@brixtol/pjax: Failed to retrive response at: ${t.key}`)}catch(e){delete x[t.key],console.error("@brixtol/pjax: Fetch error:",e)}return!1})}var ln=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});function ot(t){const e=ft(t.target,p.mouseover);e&&(sn(Dt(e.href)),Qt(e))}function Y(t){const e=ft(t.target,p.mouseover);if(!e)return;const n=b(e,f.HOVER);if(n.key in C)return;if(N(n.key))return it(e);un(e);const r=w(n),o=r.threshold||a.hover.threshold;Kt(n.key,()=>ln(this,null,function*(){if(!j("prefetch",e,n))return it(e);(yield P(r))&&it(e)}),o)}function Qt(t){q?t.addEventListener("pointerenter",Y,!1):t.addEventListener("mouseenter",Y,!1)}function un(t){q?(t.addEventListener("pointerout",ot,!1),t.removeEventListener("pointerenter",Y,!1)):(t.addEventListener("mouseleave",ot,!1),t.removeEventListener("mouseenter",Y,!1))}function it(t){q?(t.removeEventListener("pointerenter",Y,!1),t.removeEventListener("pointerout",ot,!1)):(t.removeEventListener("mouseleave",ot,!1),t.removeEventListener("mouseenter",Y,!1))}function Zt(){!a.hover||d.has(4)||(H(Qt,yt(p.mouseover)),d.add(4))}function te(){!d.has(4)||(mt(C),H(it,yt(p.mouseover)),d.delete(4))}var hn=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});let _;function dn(t){return hn(this,null,function*(){if(t.isIntersecting){const e=b(t.target,f.INTERSECT);if(!j("prefetch",t.target,e))return _.unobserve(t.target);(yield P(w(e)))?_.unobserve(t.target):(console.warn(`@brixtol/pjax: Prefetch will retry at next intersect for: ${e.key}`),_.observe(t.target))}})}function ee(){!a.intersect||d.has(5)||(_=new IntersectionObserver(H(dn),a.intersect),H(_.observe,Me(p.intersect,p.interhref)),d.add(5))}function ne(){!d.has(5)||(_.disconnect(),d.has(5))}var Lt=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});function fn(t){return new Promise((e,n)=>{const r=document.createElement("script");r.addEventListener("error",n),r.async=!1,r.text=t.target.text;for(const{nodeName:o,nodeValue:s}of t.target.attributes)r.setAttribute(o,s);document.contains(t.target)?t.target.replaceWith(r):(document.head.append(r),t.external?r.addEventListener("load",()=>r.remove()):r.remove()),t.external?r.addEventListener("load",()=>e()):e()})}function pn(t){if(!t.hasAttribute("src")&&!t.text)return;const e=t.type?t.type.trim().toLowerCase():"text/javascript",n=Te.test(e)?1:e==="module"?2:NaN,r=g(null);return r.blocking=!0,r.evaluate=!1,r.external=!1,isNaN(n)||t.noModule&&n===1||(t.src&&(r.external=!0),(n!==1||r.external&&(t.hasAttribute("async")||t.defer))&&(r.blocking=!1),r.evaluate=!0,r.target=t),r}function re(t){return Lt(this,null,function*(){try{const e=fn(t);t.blocking&&(yield e)}catch(e){console.error(e)}})}function yn(t){return Lt(this,null,function*(){const e=W(t,pn).filter(n=>n.evaluate).reduce((n,r)=>Lt(this,null,function*(){return r.external?Promise.all([n,re(r)]):(yield n,yield re(r))}),Promise.resolve());yield Promise.race([e])})}var mn=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});function vn({clientX:t,clientY:e},n){return t<=n.right&&t>=n.left&&e<=n.bottom&&e>=n.top}function gn(t){const e=g(null),n=t.getBoundingClientRect(),r=t.getAttribute(`${a.schema}-proximity`),o=dt.test(r)?Number(r):a.proximity.distance;return e.target=t,e.top=n.top-o,e.bottom=n.bottom+o,e.left=n.left-o,e.right=n.right+o,e}function xn(t){let e=!1;return n=>{if(e)return;e=!0;const r=t.findIndex(o=>vn(n,o));if(r===-1)setTimeout(()=>{e=!1},a.proximity.throttle);else{const{target:o}=t[r],s=w(b(o,f.PROXIMITY));Kt(s.key,()=>mn(this,null,function*(){if(!j("prefetch",o,s))return st();(yield P(s))&&(t.splice(r,1),e=!1,t.length===0&&(st(),console.info("@brixtol/pjax: Proximity observer has disconnected")))}),s.threshold||a.proximity.threshold)}}}let G;function oe(){if(!a.proximity||d.has(7))return;const t=yt(p.proximity).map(gn);t.length>0&&(G=xn(t),q?addEventListener("pointermove",G,!1):addEventListener("mousemove",G,!1),d.add(7))}function st(){!d.has(7)||(q?removeEventListener("pointermove",G,!1):removeEventListener("mousemove",G,!1),d.delete(7))}var En=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});function bn(t,e){return t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING||-1}function $n(t){return En(this,null,function*(){const e=W(t.querySelectorAll(p.scripts));e.sort(bn),yield yn(e)})}function wn(t){t.querySelectorAll(p.track).forEach(e=>{!e.hasAttribute("id")||ht.has(e.id)||(document.body.appendChild(e),ht.add(e.id))})}function kn(t,e){const n=t.replace?t.replace:a.targets,r=n.join(","),o=document.body.querySelectorAll(r);if(o.length===0)return document.body.replaceWith(e.body);const s=e.body.querySelectorAll(r);o.forEach((c,l)=>{if(!!c.matches(n[l])&&!!j("render",c,s[l])&&(c.replaceWith(s[l]),t.append||t.prepend)){const i=document.createElement("div");return e.childNodes.forEach(i.appendChild),t.append?c.appendChild(i):c.insertBefore(i,c.firstChild)}}),wn(e.body)}function Pn(t,e){const n=t.hydrate.join(","),r=document.body.querySelectorAll(n);if(r.length>0){const o=e.body.querySelectorAll(n);r.forEach((s,c)=>{!j("hydrate",s,o[c])||!o[c]||(s.firstChild.nodeType===Node.TEXT_NODE?s.innerHTML=o[c].innerHTML:s.replaceWith(o[c]))})}t.history=void 0,t.type=f.VISIT,nt(t),Bt([t.key])}function V(t,e){a.hover!==!1&&te(),a.intersect!==!1&&ne(),a.proximity!==!1&&st();const n=gt($[t.snapshot]);return t.title=document.title=n.title||"",t.type===f.HYDRATE?Pn(t,n):(kn(t,n),t.history&&(e||(t.key===t.location.lastpath?E.replace(t.location,t):E.push(t.location,t)),scrollTo(t.position.x,t.position.y))),$n(n.head),nn(),a.hover!==!1&&Zt(),a.intersect!==!1&&ee(),a.proximity!==!1&&oe(),j("load",t),t}var Tn=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});let ie=null,At;function se(t){return E.replace(E.location,t),E.location.state}function Ln(){if(E.location.state===null)return!1;const t=E.location.state;return"location"in t&&"lastpath"in t.location?t.location.lastpath:!1}function An(){E.location.state===null&&(E.location.state=window.history.state||se(null));const t=A(E.location.state,{position:tt()});return E.replace(E.location,t),t}function jn(t){return Tn(this,arguments,function*({key:e,state:n}){if(n.key!==At&&Gt(At),console.log("POSTATE",n.key,N(n.key)),N(n.key))return V(n,!0);At=n.key,n.type=f.POPSTATE;const r=yield P(n);return r?V(r,!0):location.assign(n.key)})}function In({action:t,location:e}){if(console.log("LISTENER",t,e),t===R.Pop)return jn(e)}function Sn(){d.has(2)||(ie=E.listen(In),d.add(2))}function On(){d.has(2)&&(ie(),d.delete(2))}var Cn=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});function Nn(t){return!(t.target&&t.target.isContentEditable||t.defaultPrevented||t.which>1||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)}function ae(t,e){return function n(r){return r.preventDefault(),t.removeEventListener("click",n,!1),An(),typeof e=="object"?V(e):typeof e=="string"?jt(e):location.assign(e)}}function z(t){if(!Nn(t))return;const e=ft(t.target,p.href);if(!e)return;const n=b(e,f.VISIT);!j("trigger",t,n)||(N(n.key)?e.addEventListener("click",ae(e,nt(n)),!1):(n.key in x&&be(x).length>1&&cn(n.key),P(w(n)),e.addEventListener("click",ae(e,n.key),!1)))}function jt(t,e=!1){return Cn(this,null,function*(){if(e){typeof e.cache=="string"&&!e.hydrate&&(e.cache==="clear"?et():et(e.key));const n=yield P(e);if(n)return V(n)}else{if(yield Jt(t))return V(m[t]);Gt(t)}return location.assign(t)})}function Rn(){d.has(3)||(q?addEventListener("pointerdown",z,!1):(addEventListener("mousedown",z,!1),addEventListener("touchstart",z,!1)),d.add(3))}function Mn(){!d.has(3)||(q?removeEventListener("pointerdown",z,!1):(removeEventListener("mousedown",z,!1),removeEventListener("touchstart",z,!1)),d.delete(3))}function ce(){const t=w(b(f.INITIAL)),e=Ln();a.reverse&&typeof e=="string"&&(t.location.lastpath=e);const n=Ft(t,document.documentElement.outerHTML);if(t.position=tt(),j("connected",n),a.preload!==null){if(Mt(a.preload))for(const r of a.preload){const o=b(r,f.PRELOAD);o.key!==r&&P(w(o))}else if(typeof a.preload=="object"&&t.key in a.preload)for(const r of a.preload[t.key]){const o=b(r,f.PRELOAD);o.key!==r&&P(w(o))}}if(se(n),n.location.lastpath!==t.key){const r=b(n.location.lastpath,f.REVERSE);P(w(r))}removeEventListener("load",ce)}function Hn(){d.has(1)||(Sn(),Ue(),Rn(),Zt(),ee(),oe(),addEventListener("load",ce),d.add(1),console.info("@brixtol/pjax: Connection Established \u26A1"))}function qn(){d.has(1)?(On(),We(),Mn(),te(),ne(),st(),et(),d.delete(1),console.warn("@brixtol/pjax: Instance has been disconnected! \u{1F614}")):console.warn("@brixtol/pjax: No connection made, disconnection is void \u{1F643}")}var U=(t,e,n)=>new Promise((r,o)=>{var s=i=>{try{l(n.next(i))}catch(u){o(u)}},c=i=>{try{l(n.throw(i))}catch(u){o(u)}},l=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);l((n=n.apply(t,e)).next())});const le=!!(window.history.pushState&&window.requestAnimationFrame&&window.addEventListener&&window.DOMParser);function Dn(t={}){De(t),le?/https?/.test(window.location.protocol)?addEventListener("DOMContentLoaded",Hn):console.error("@brixtol/pjax: Invalid protocol, pjax expects https or http protocol"):console.error("@brixtol/pjax: Not supported by this browser")}function Vn(){return $e}function Fn(t){return U(this,null,function*(){const e=bt("page");t&&A(e,t),e.type=f.RELOAD;const n=yield P(e);return n?(console.info("@brixtol/pjax: Triggered reload, page was re-cached"),V(n)):(console.warn("@brixtol/pjax: Reload failed, triggering refresh (cache will be purged)"),location.assign(e.key))})}function Bn(t){const e=g(null);return t?t in m?Ke(t):console.error(`@brixtol/pjax: No store exists for ${t}`):(e.state=m,e.snaps=$,e.size=an(),e)}function Xn(t){return U(this,null,function*(){const e=b(t,f.FETCH);if(e.location.origin!==vt)return console.error("@brixtol/pjax: Cross origin fetches are not allowed");const n=yield Tt(e.key);if(n)return gt(n)})}function Yn(t){return et(t)}function _n(t){return U(this,null,function*(){})}function zn(t,e){return U(this,null,function*(){const n=b(f.HYDRATE);n.hydrate=e,n.position=tt();const r=yield Tt(t);if(!r)return console.warn("@brixtol/pjax: hydration failed");const o=N(n.key)?nt(n,r):w(n);if(a.reverse){const s=b(n.location.lastpath,f.REVERSE);P(s)}return V(o)})}function Un(t){return U(this,null,function*(){const e=b(t,f.PREFETCH);if(N(e.key)){console.warn(`@brixtol/pjax: Cache already exists for ${e.key}, prefetch skipped`);return}const n=yield P(w(e));if(n)return n;console.warn(`@brixtol/pjax: Prefetch failed for ${e.key}`)})}function Wn(t,e){return U(this,null,function*(){const n=b(t),r=typeof e=="object"?A(n,e):n;return N(n.key)?jt(n.key,nt(r)):jt(n.key,w(r))})}function Kn(){qn()}v.cache=Bn,v.clear=Yn,v.connect=Dn,v.disconnect=Kn,v.fetch=Xn,v.hydrate=zn,v.off=Ye,v.on=Xe,v.prefetch=Un,v.reload=Fn,v.session=Vn,v.supported=le,v.update=_n,v.visit=Wn,Object.defineProperty(v,"__esModule",{value:!0})});
